# Product Overview

## Product Purpose

Claude CodeのPreToolUseフック向けのLLMベース検証ツール。ツール実行直前に危険な操作を検出し、自動的にブロックすることで、安全なコマンド実行環境を提供する。

従来のスラッシュコマンドベースのフック（[PreToolUseフック公式ドキュメント](https://docs.claude.com/en/docs/claude-code/hooks#pretooluse-decision-control)、[BigQueryガードレール設計事例](https://www.yasuhisay.info/entry/2025/08/31/144559)、[validate_bq_query実装例](https://github.com/syou6162/claude-code-commands/blob/main/commands/validate_bq_query.md)）では出力形式の保証が難しく、回避策を防ぐことも困難だった。本ツールはClaude Agent SDKを使い、LLMの判断力を活用することで、柔軟かつ確実な検証を実現する。

## Target Users

### 主要ユーザー
- **Claude Code利用者**: フックを使って安全な開発環境を構築したい開発者
- **フック開発者**: カスタムルールを定義して特定のツール操作を制御したい開発者
- **チームリーダー**: チーム全体に統一されたセキュリティポリシーを適用したい人

### ユーザーのニーズと課題
- **ニーズ**: 意図しない破壊的操作（mainブランチへのpush、本番DBの削除など）を防ぎたい
- **課題**: オプション付きコマンド（`git push --force`など）での回避を防げない
- **課題**: フックの出力形式が不安定で、JSON schemaに従わないことがある

## Key Features

1. **LLMベースの柔軟な検証**: 正規表現だけでは検出できない複雑なパターンもLLMが判定
2. **YAML設定ファイル**: シンプルな設定で検証ルールを定義可能
3. **実用例の提供**: GitやBigQueryなど、よくあるユースケースの設定例を同梱
4. **標準JSON出力**: Claude Code PreToolUse標準形式への準拠を保証
5. **拡張性**: 新しいツールやルールを簡単に追加できる設計

## Business Objectives

- **安全性の向上**: 危険な操作を事前にブロックし、事故を未然に防ぐ
- **開発効率の維持**: 過度な制約なく、必要な操作は許可する柔軟性
- **設定の簡便性**: YAML設定で誰でも簡単にルールを追加・カスタマイズ可能
- **コミュニティ貢献**: オープンソースとして公開し、他の開発者にも活用してもらう

## Success Metrics

- **検出精度**: 危険な操作の検出率 95%以上
- **誤検出率**: 安全な操作の誤ブロック率 5%以下
- **設定の容易さ**: 新しいルール追加に要する時間 10分以内
- **応答速度**: フック判定の応答時間 2秒以内

## Product Principles

1. **LLMの判断力を信頼**: 複雑なパターンマッチングよりもLLMの文脈理解を活用
2. **設定優先**: コード変更なしで、設定ファイルだけでルールを追加できる
3. **実例から学ぶ**: GitやBigQueryなど実用的な例を提供し、すぐに使える状態にする
4. **透明性**: 判定理由を必ず出力し、なぜブロックされたかを明確にする

## Monitoring & Visibility (if applicable)

本ツール自体は単発のCLIツールとして動作し、ダッシュボードは不要。

- **実行ログ**: 標準エラー出力に判定プロセスを記録
- **JSON出力**: 標準出力に構造化された判定結果を出力
- **デバッグモード**: `--verbose`フラグでLLMプロンプトや応答を標準エラー出力に記録

## Future Vision

### Potential Enhancements
- **ルールテスト機能**: 設定ファイルのテストケースを定義し、期待通りの判定が返るか検証
- **ルールライブラリ**: コミュニティで共有できるルール集（npm publish保護、Docker操作保護など）
- **統計情報**: どのルールが頻繁に発火しているかを記録・分析
- **GitHub Actions連携**: CI/CDでのフック検証を自動化
